<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Proxmox Natural Language Interface</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.7.2/font/bootstrap-icons.css" rel="stylesheet">
    <link href="/static/css/styles.css" rel="stylesheet">
</head>
<body>
    <nav class="navbar navbar-expand-lg navbar-dark bg-primary mb-4">
        <div class="container-fluid">
            <a class="navbar-brand" href="#">
                <img src="/static/TessaLogo.webp" alt="TESSA" height="30" class="d-inline-block align-text-top me-2">
                TESSA - Proxmox NLI
            </a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav me-auto">
                    <li class="nav-item">
                        <a class="nav-link active" href="#">Dashboard</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#" data-bs-toggle="modal" data-bs-target="#setupWizardModal">Setup Wizard</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#" data-bs-toggle="modal" data-bs-target="#userPrefsModal">Preferences</a>
                    </li>
                </ul>
                <div class="d-flex align-items-center">
                    <label for="experienceLevel" class="form-label text-light me-2">Experience Level:</label>
                    <select class="form-select form-select-sm" id="experienceLevel">
                        <option value="beginner">Beginner</option>
                        <option value="intermediate">Intermediate</option>
                        <option value="advanced">Advanced</option>
                    </select>
                </div>
            </div>
        </div>
    </nav>

    <div class="container">
        <div class="row">
            <!-- Chat Interface -->
            <div class="col-md-7">
                <div class="chat-container">
                    <div class="chat-header">
                        <h2>Proxmox Natural Language Interface</h2>
                        <p class="mb-0">Ask questions or give commands to manage your Proxmox VE environment</p>
                    </div>
                    <div class="chat-body" id="chat-body">
                        <div class="message system">
                            Hello! I'm TESSA, your Proxmox Natural Language Interface. How can I help you today?
                            Try commands like:
                            <ul>
                                <li>list vms</li>
                                <li>start vm 100</li>
                                <li>get status of node pve</li>
                                <li>type 'help' to see all available commands</li>
                            </ul>
                        </div>
                    </div>
                    <div class="chat-footer">
                        <form id="chat-form">
                            <div class="input-group">
                                <input type="text" id="user-input" class="form-control" placeholder="Type your question or command..." autocomplete="off">
                                <button id="mic-button" type="button">
                                    <i class="bi bi-mic-fill"></i>
                                </button>
                                <button class="btn btn-primary" type="submit">Send</button>
                            </div>
                        </form>
                    </div>
                </div>
            </div>

            <!-- Status and Monitoring -->
            <div class="col-md-5">
                <!-- Progressive Disclosure Tabs -->
                <ul class="nav nav-tabs mb-3" id="monitoringTabs" role="tablist">
                    <li class="nav-item" role="presentation">
                        <button class="nav-link active" id="basic-tab" data-bs-toggle="tab" data-bs-target="#basic" type="button" role="tab" aria-controls="basic" aria-selected="true">Basic</button>
                    </li>
                    <li class="nav-item" role="presentation">
                        <button class="nav-link" id="advanced-tab" data-bs-toggle="tab" data-bs-target="#advanced" type="button" role="tab" aria-controls="advanced" aria-selected="false">Advanced</button>
                    </li>
                    <li class="nav-item" role="presentation">
                        <button class="nav-link" id="logs-tab" data-bs-toggle="tab" data-bs-target="#logs" type="button" role="tab" aria-controls="logs" aria-selected="false">Logs</button>
                    </li>
                    <li class="nav-item" role="presentation">
                        <button class="nav-link" id="command-history-tab" data-bs-toggle="tab" data-bs-target="#command-history" type="button" role="tab" aria-controls="command-history" aria-selected="false">
                            <i class="bi bi-clock-history"></i> History
                        </button>
                    </li>
                    <li class="nav-item" role="presentation">
                        <button class="nav-link" id="favorite-commands-tab" data-bs-toggle="tab" data-bs-target="#favorite-commands" type="button" role="tab" aria-controls="favorite-commands" aria-selected="false">
                            <i class="bi bi-star"></i> Favorites
                        </button>
                    </li>
                </ul>
                
                <div class="tab-content" id="monitoringTabContent">
                    <!-- Basic Tab - Simple status info -->
                    <div class="tab-pane fade show active" id="basic" role="tabpanel" aria-labelledby="basic-tab">
                        <div class="status-container">
                            <h3>System Status</h3>
                            <div id="cluster-status">
                                <div class="spinner-border text-primary" role="status">
                                    <span class="visually-hidden">Loading...</span>
                                </div>
                            </div>
                        </div>

                        <div class="status-container">
                            <h3>Virtual Machines</h3>
                            <div id="vm-list">
                                <div class="spinner-border text-primary" role="status">
                                    <span class="visually-hidden">Loading...</span>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Advanced Tab - Detailed information and network diagram -->
                    <div class="tab-pane fade" id="advanced" role="tabpanel" aria-labelledby="advanced-tab">
                        <div class="status-container">
                            <h3>Network Diagram</h3>
                            <div id="network-diagram-container" style="height: 400px; border: 1px solid #ccc; border-radius: 4px;">
                                <div class="spinner-border text-primary" role="status">
                                    <span class="visually-hidden">Loading...</span>
                                </div>
                            </div>
                        </div>
                        
                        <div class="status-container">
                            <h3>Resource Usage</h3>
                            <div id="resource-usage">
                                <div class="resource-graph">
                                    <h4>CPU Usage</h4>
                                    <div id="cpu-chart"></div>
                                </div>
                                <div class="resource-graph">
                                    <h4>Memory Usage</h4>
                                    <div id="memory-chart"></div>
                                </div>
                                <div class="resource-graph">
                                    <h4>Storage Usage</h4>
                                    <div id="storage-chart"></div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Logs Tab - Audit logs -->
                    <div class="tab-pane fade" id="logs" role="tabpanel" aria-labelledby="logs-tab">
                        <div class="status-container">
                            <h3>Audit Logs</h3>
                            <div id="audit-log">
                                <div class="spinner-border text-primary" role="status">
                                    <span class="visually-hidden">Loading...</span>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Command History Tab -->
                    <div class="tab-pane fade" id="command-history" role="tabpanel" aria-labelledby="command-history-tab">
                        <div class="status-container">
                            <div class="d-flex justify-content-between align-items-center">
                                <h3>Command History</h3>
                                <div>
                                    <span class="badge bg-primary" data-bs-toggle="tooltip" title="Commands are stored locally and synchronized with your account">
                                        <i class="bi bi-info-circle"></i> Info
                                    </span>
                                </div>
                            </div>
                            <p class="text-muted">Review, reuse, or save your previous commands</p>
                            <div id="command-history-list">
                                <div class="spinner-border text-primary" role="status">
                                    <span class="visually-hidden">Loading...</span>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Favorite Commands Tab -->
                    <div class="tab-pane fade" id="favorite-commands" role="tabpanel" aria-labelledby="favorite-commands-tab">
                        <div class="status-container">
                            <div class="d-flex justify-content-between align-items-center">
                                <h3>Favorite Commands</h3>
                            </div>
                            <p class="text-muted">Quick access to your saved commands</p>
                            <div id="favorite-commands-list">
                                <div class="spinner-border text-primary" role="status">
                                    <span class="visually-hidden">Loading...</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="audit-container">
                    <h3>Audit Log</h3>
                    <div id="audit-log"></div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Setup Wizard Modal -->
    <div class="modal fade" id="setupWizardModal" tabindex="-1" aria-labelledby="setupWizardModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="setupWizardModalLabel">Goal-Based Setup Wizard</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <!-- Wizard Navigation -->
                    <ul class="nav nav-pills nav-justified mb-3" id="wizardSteps" role="tablist">
                        <li class="nav-item" role="presentation">
                            <button class="nav-link active" id="step1-tab" data-bs-toggle="pill" data-bs-target="#step1" type="button" role="tab" aria-controls="step1" aria-selected="true">Goals</button>
                        </li>
                        <li class="nav-item" role="presentation">
                            <button class="nav-link" id="step2-tab" data-bs-toggle="pill" data-bs-target="#step2" type="button" role="tab" aria-controls="step2" aria-selected="false">Resources</button>
                        </li>
                        <li class="nav-item" role="presentation">
                            <button class="nav-link" id="step3-tab" data-bs-toggle="pill" data-bs-target="#step3" type="button" role="tab" aria-controls="step3" aria-selected="false">Services</button>
                        </li>
                        <li class="nav-item" role="presentation">
                            <button class="nav-link" id="step4-tab" data-bs-toggle="pill" data-bs-target="#step4" type="button" role="tab" aria-controls="step4" aria-selected="false">Summary</button>
                        </li>
                    </ul>
                    
                    <!-- Wizard Content -->
                    <div class="tab-content" id="wizardStepsContent">
                        <!-- Step 1: Goals -->
                        <div class="tab-pane fade show active" id="step1" role="tabpanel" aria-labelledby="step1-tab">
                            <h4>What would you like to accomplish with your home server?</h4>
                            <p class="text-muted">Select all that apply</p>
                            
                            <div class="row mt-4">
                                <div class="col-md-6">
                                    <div class="form-check mb-3">
                                        <input class="form-check-input" type="checkbox" value="media" id="goalMedia">
                                        <label class="form-check-label" for="goalMedia">
                                            <i class="bi bi-film"></i> Media Server (Movies, TV, Music)
                                        </label>
                                    </div>
                                    <div class="form-check mb-3">
                                        <input class="form-check-input" type="checkbox" value="files" id="goalFiles">
                                        <label class="form-check-label" for="goalFiles">
                                            <i class="bi bi-folder"></i> File Storage & Backup
                                        </label>
                                    </div>
                                    <div class="form-check mb-3">
                                        <input class="form-check-input" type="checkbox" value="webhosting" id="goalWeb">
                                        <label class="form-check-label" for="goalWeb">
                                            <i class="bi bi-globe"></i> Self-host Websites
                                        </label>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="form-check mb-3">
                                        <input class="form-check-input" type="checkbox" value="homeauto" id="goalHomeAuto">
                                        <label class="form-check-label" for="goalHomeAuto">
                                            <i class="bi bi-house"></i> Home Automation
                                        </label>
                                    </div>
                                    <div class="form-check mb-3">
                                        <input class="form-check-input" type="checkbox" value="productivity" id="goalProductivity">
                                        <label class="form-check-label" for="goalProductivity">
                                            <i class="bi bi-calendar"></i> Office/Productivity Tools
                                        </label>
                                    </div>
                                    <div class="form-check mb-3">
                                        <input class="form-check-input" type="checkbox" value="gaming" id="goalGaming">
                                        <label class="form-check-label" for="goalGaming">
                                            <i class="bi bi-controller"></i> Game Servers
                                        </label>
                                    </div>
                                    <div class="form-check mb-3">
                                        <input class="form-check-input" type="checkbox" value="privacy" id="goalPrivacy">
                                        <label class="form-check-label" for="goalPrivacy">
                                            <i class="bi bi-shield-lock"></i> Privacy & Security
                                        </label>
                                    </div>
                                    <div class="form-check mb-3">
                                        <input class="form-check-input" type="checkbox" value="networking" id="goalNetworking">
                                        <label class="form-check-label" for="goalNetworking">
                                            <i class="bi bi-hdd-network"></i> Network Management
                                        </label>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="mt-4">
                                <label for="otherGoals" class="form-label">Other goals or needs:</label>
                                <textarea class="form-control" id="otherGoals" rows="2"></textarea>
                            </div>
                            
                            <div class="d-flex justify-content-end mt-3">
                                <button class="btn btn-primary" id="step1-next">Next</button>
                            </div>
                        </div>
                        
                        <!-- Step 2: Resources -->
                        <div class="tab-pane fade" id="step2" role="tabpanel" aria-labelledby="step2-tab">
                            <h4>Hardware Resources</h4>
                            <p class="text-muted">Please confirm your available resources</p>
                            
                            <div id="detected-resources" class="mb-4">
                                <div class="spinner-border text-primary" role="status">
                                    <span class="visually-hidden">Detecting resources...</span>
                                </div>
                                <span class="ms-2">Detecting system resources...</span>
                            </div>
                            
                            <div class="row">
                                <div class="col-md-6">
                                    <div class="mb-3">
                                        <label for="cpuCores" class="form-label">CPU Cores</label>
                                        <input type="number" class="form-control" id="cpuCores" value="4" min="1">
                                    </div>
                                    <div class="mb-3">
                                        <label for="ramSize" class="form-label">RAM (GB)</label>
                                        <input type="number" class="form-control" id="ramSize" value="8" min="1">
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="mb-3">
                                        <label for="diskSize" class="form-label">Storage Space (GB)</label>
                                        <input type="number" class="form-control" id="diskSize" value="500" min="1">
                                    </div>
                                    <div class="mb-3">
                                        <label for="networkSpeed" class="form-label">Network Speed (Mbps)</label>
                                        <input type="number" class="form-control" id="networkSpeed" value="100" min="1">
                                    </div>
                                </div>
                            </div>
                            
                            <div class="d-flex justify-content-between mt-3">
                                <button class="btn btn-secondary" id="step2-prev" onclick="nextWizardStep('step1-tab')">Previous</button>
                                <button class="btn btn-primary" id="step2-next" onclick="nextWizardStep('step3-tab')">Next</button>
                            </div>
                        </div>
                        
                        <!-- Step 3: Services -->
                        <div class="tab-pane fade" id="step3" role="tabpanel" aria-labelledby="step3-tab">
                            <h4>Recommended Services</h4>
                            <p class="text-muted">Based on your goals, here are some recommended services:</p>
                            
                            <div id="recommended-services" class="mb-4">
                                <!-- Will be populated dynamically based on goals -->
                                <div class="alert alert-info">
                                    Please select your goals in step 1 to see recommended services.
                                </div>
                            </div>
                            
                            <div class="d-flex justify-content-between mt-3">
                                <button class="btn btn-secondary" id="step3-prev" onclick="nextWizardStep('step2-tab')">Previous</button>
                                <button class="btn btn-primary" id="step3-next" onclick="nextWizardStep('step4-tab')">Next</button>
                            </div>
                        </div>
                        
                        <!-- Step 4: Summary -->
                        <div class="tab-pane fade" id="step4" role="tabpanel" aria-labelledby="step4-tab">
                            <h4>Setup Summary</h4>
                            <p class="text-muted">Here's what we're going to set up for you:</p>
                            
                            <div class="card mb-3">
                                <div class="card-header">
                                    <h5 class="mb-0">Goals</h5>
                                </div>
                                <div class="card-body" id="summary-goals">
                                    <!-- Will be populated dynamically -->
                                </div>
                            </div>
                            
                            <div class="card mb-3">
                                <div class="card-header">
                                    <h5 class="mb-0">Services to Install</h5>
                                </div>
                                <div class="card-body" id="summary-services">
                                    <!-- Will be populated dynamically -->
                                </div>
                            </div>
                            
                            <div class="card mb-3">
                                <div class="card-header">
                                    <h5 class="mb-0">Resource Allocation</h5>
                                </div>
                                <div class="card-body" id="summary-resources">
                                    <!-- Will be populated dynamically -->
                                </div>
                            </div>
                            
                            <div class="d-flex justify-content-between mt-3">
                                <button class="btn btn-secondary" id="step4-prev" onclick="nextWizardStep('step3-tab')">Previous</button>
                                <button class="btn btn-primary" id="deploy-button">Deploy Services</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- User Preferences Modal -->
    <div class="modal fade" id="userPrefsModal" tabindex="-1" aria-labelledby="userPrefsModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="userPrefsModalLabel">User Preferences</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <ul class="nav nav-tabs mb-3" id="preferencesTab" role="tablist">
                        <li class="nav-item" role="presentation">
                            <button class="nav-link active" id="general-pref-tab" data-bs-toggle="tab" data-bs-target="#general-pref" type="button" role="tab">General</button>
                        </li>
                        <li class="nav-item" role="presentation">
                            <button class="nav-link" id="voice-pref-tab" data-bs-toggle="tab" data-bs-target="#voice-pref" type="button" role="tab">Voice</button>
                        </li>
                        <li class="nav-item" role="presentation">
                            <button class="nav-link" id="notification-pref-tab" data-bs-toggle="tab" data-bs-target="#notification-pref" type="button" role="tab">Notifications</button>
                        </li>
                    </ul>
                    
                    <div class="tab-content" id="preferencesTabContent">
                        <!-- General Preferences Tab -->
                        <div class="tab-pane fade show active" id="general-pref" role="tabpanel" aria-labelledby="general-pref-tab">
                            <form id="user-preferences-form">
                                <div class="mb-3">
                                    <label for="userName" class="form-label">Your Name</label>
                                    <input type="text" class="form-control" id="userName" placeholder="John Doe">
                                </div>
                                <div class="mb-3">
                                    <label for="defaultVmTemplate" class="form-label">Default VM Template</label>
                                    <select class="form-select" id="defaultVmTemplate">
                                        <option value="ubuntu-2204">Ubuntu 22.04</option>
                                        <option value="debian-12">Debian 12</option>
                                        <option value="centos-stream-9">CentOS Stream 9</option>
                                        <option value="win-2022">Windows Server 2022</option>
                                    </select>
                                </div>
                                <div class="mb-3">
                                    <label for="defaultVmMemory" class="form-label">Default VM Memory (MB)</label>
                                    <input type="number" class="form-control" id="defaultVmMemory" value="2048" min="512">
                                </div>
                                <div class="mb-3">
                                    <label for="defaultVmCores" class="form-label">Default VM CPU Cores</label>
                                    <input type="number" class="form-control" id="defaultVmCores" value="2" min="1">
                                </div>
                            </form>
                        </div>
                        
                        <!-- Voice Settings Tab -->
                        <div class="tab-pane fade" id="voice-pref" role="tabpanel" aria-labelledby="voice-pref-tab">
                            <div class="mb-3">
                                <label for="voice-profile" class="form-label">Voice Profile</label>
                                <select class="form-select" id="voice-profile">
                                    <option value="tessa_default">TESSA Default</option>
                                    <option value="tessa_warm">TESSA Warm</option>
                                    <option value="tessa_professional">TESSA Professional</option>
                                    <!-- Dynamically populated with other profiles -->
                                </select>
                            </div>
                            <div class="mb-3">
                                <label for="voice-accent" class="form-label">Accent</label>
                                <select class="form-select" id="voice-accent">
                                    <option value="com">US English</option>
                                    <option value="co.uk">British English</option>
                                    <option value="com.au">Australian English</option>
                                    <option value="ca">Canadian English</option>
                                    <option value="co.in">Indian English</option>
                                    <option value="ie">Irish English</option>
                                    <option value="co.za">South African English</option>
                                </select>
                            </div>
                            <div class="mb-3">
                                <label for="voice-speed" class="form-label">Speaking Speed</label>
                                <select class="form-select" id="voice-speed">
                                    <option value="false">Normal</option>
                                    <option value="true">Slow</option>
                                </select>
                            </div>
                            <div class="mb-3">
                                <label for="voice-style" class="form-label">Conversation Style</label>
                                <select class="form-select" id="voice-style">
                                    <option value="friendly">Friendly</option>
                                    <option value="professional">Professional</option>
                                    <option value="casual">Casual</option>
                                    <option value="enthusiastic">Enthusiastic</option>
                                </select>
                            </div>
                            <div class="mb-3">
                                <label for="personality-level" class="form-label">Personality Level</label>
                                <input type="range" class="form-range" min="0" max="100" value="20" id="personality-level">
                                <small class="form-text text-muted">Controls how often TESSA adds personality phrases to responses</small>
                            </div>
                            <div class="form-check form-switch mb-3">
                                <input class="form-check-input" type="checkbox" id="enable-personality" checked>
                                <label class="form-check-label" for="enable-personality">Enable Personality Quirks</label>
                            </div>
                            <button type="button" class="btn btn-primary" id="save-voice-settings">Save Voice Settings</button>
                            <button type="button" class="btn btn-secondary ms-2" id="test-voice">Test Voice</button>
                        </div>
                        
                        <!-- Notification Preferences Tab -->
                        <div class="tab-pane fade" id="notification-pref" role="tabpanel" aria-labelledby="notification-pref-tab">
                            <div class="mb-3">
                                <h5>Notification Settings</h5>
                                <p class="text-muted">Choose how and when you'd like to be notified about events</p>
                            </div>
                            
                            <div id="notification-preferences-loading" class="text-center">
                                <div class="spinner-border text-primary" role="status">
                                    <span class="visually-hidden">Loading...</span>
                                </div>
                                <span class="ms-2">Loading notification settings...</span>
                            </div>
                            
                            <div id="notification-preferences-error" class="alert alert-danger d-none">
                                Failed to load notification preferences.
                            </div>
                            
                            <div id="notification-preferences-container" class="d-none">
                                <!-- Will be populated with notification preferences -->
                                <div class="accordion" id="notification-categories">
                                    <!-- VM Events Category -->
                                    <div class="accordion-item">
                                        <h2 class="accordion-header" id="vm-events-header">
                                            <button class="accordion-button" type="button" data-bs-toggle="collapse" data-bs-target="#vm-events-collapse">
                                                Virtual Machine Events
                                            </button>
                                        </h2>
                                        <div id="vm-events-collapse" class="accordion-collapse collapse show" aria-labelledby="vm-events-header">
                                            <div class="accordion-body">
                                                <div id="vm-events-prefs">
                                                    <!-- Will be populated dynamically -->
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <!-- Backup Events Category -->
                                    <div class="accordion-item">
                                        <h2 class="accordion-header" id="backup-events-header">
                                            <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#backup-events-collapse">
                                                Backup Events
                                            </button>
                                        </h2>
                                        <div id="backup-events-collapse" class="accordion-collapse collapse" aria-labelledby="backup-events-header">
                                            <div class="accordion-body">
                                                <div id="backup-events-prefs">
                                                    <!-- Will be populated dynamically -->
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <!-- Security Events Category -->
                                    <div class="accordion-item">
                                        <h2 class="accordion-header" id="security-events-header">
                                            <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#security-events-collapse">
                                                Security Events
                                            </button>
                                        </h2>
                                        <div id="security-events-collapse" class="accordion-collapse collapse" aria-labelledby="security-events-header">
                                            <div class="accordion-body">
                                                <div id="security-events-prefs">
                                                    <!-- Will be populated dynamically -->
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <!-- System Events Category -->
                                    <div class="accordion-item">
                                        <h2 class="accordion-header" id="system-events-header">
                                            <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#system-events-collapse">
                                                System Events
                                            </button>
                                        </h2>
                                        <div id="system-events-collapse" class="accordion-collapse collapse" aria-labelledby="system-events-header">
                                            <div class="accordion-body">
                                                <div id="system-events-prefs">
                                                    <!-- Will be populated dynamically -->
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <!-- Service Events Category -->
                                    <div class="accordion-item">
                                        <h2 class="accordion-header" id="service-events-header">
                                            <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#service-events-collapse">
                                                Service Events
                                            </button>
                                        </h2>
                                        <div id="service-events-collapse" class="accordion-collapse collapse" aria-labelledby="service-events-header">
                                            <div class="accordion-body">
                                                <div id="service-events-prefs">
                                                    <!-- Will be populated dynamically -->
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="mt-4">
                                    <button type="button" id="initialize-notification-prefs" class="btn btn-outline-secondary">
                                        <i class="bi bi-arrow-repeat"></i> Reset to Default
                                    </button>
                                    <button type="button" id="save-notification-prefs" class="btn btn-primary float-end">
                                        <i class="bi bi-check-circle"></i> Save Notification Settings
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                    <button type="button" class="btn btn-primary" id="save-preferences">Save Changes</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Add the User Shortcuts Modal -->
    <div class="modal fade" id="shortcutsModal" tabindex="-1" aria-labelledby="shortcutsModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="shortcutsModalLabel">My Shortcuts</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <div id="shortcuts-loading" class="text-center py-4">
                        <div class="spinner-border text-primary" role="status">
                            <span class="visually-hidden">Loading...</span>
                        </div>
                        <p class="mt-2">Loading your shortcuts...</p>
                    </div>
                    
                    <div id="shortcuts-error" class="alert alert-danger d-none"></div>
                    
                    <div id="shortcuts-container" class="d-none">
                        <!-- Categories will be rendered here -->
                        <div class="accordion" id="shortcutCategories">
                            <!-- Category items will be inserted here -->
                        </div>
                        
                        <div class="mt-4">
                            <button id="add-shortcut-btn" class="btn btn-primary">
                                <i class="bi bi-plus-circle"></i> Add New Shortcut
                            </button>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button id="initialize-shortcuts" class="btn btn-secondary">Reset to Default</button>
                    <button type="button" class="btn btn-primary" data-bs-dismiss="modal">Close</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Add Shortcut Modal -->
    <div class="modal fade" id="addShortcutModal" tabindex="-1" aria-labelledby="addShortcutModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="addShortcutModalLabel">Add New Shortcut</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form id="shortcut-form">
                        <div class="mb-3">
                            <label for="shortcut-name" class="form-label">Name</label>
                            <input type="text" class="form-control" id="shortcut-name" required>
                            <div class="form-text">A short, descriptive name for this shortcut</div>
                        </div>
                        
                        <div class="mb-3">
                            <label for="shortcut-command" class="form-label">Command</label>
                            <input type="text" class="form-control" id="shortcut-command" required>
                            <div class="form-text">
                                The command to execute. You can include placeholders like {{vm_id}} that will be 
                                replaced when you use the shortcut.
                            </div>
                        </div>
                        
                        <div class="mb-3">
                            <label for="shortcut-description" class="form-label">Description</label>
                            <textarea class="form-control" id="shortcut-description" rows="2"></textarea>
                            <div class="form-text">Optional description of what this shortcut does</div>
                        </div>
                        
                        <div class="mb-3">
                            <label for="shortcut-category" class="form-label">Category</label>
                            <input type="text" class="form-control" id="shortcut-category" list="shortcut-categories">
                            <datalist id="shortcut-categories">
                                <!-- Categories will be populated dynamically -->
                            </datalist>
                            <div class="form-text">Group related shortcuts together (e.g., "VM Management", "Backups")</div>
                        </div>
                        
                        <div class="mb-3">
                            <label for="shortcut-icon" class="form-label">Icon</label>
                            <div class="input-group">
                                <span class="input-group-text"><i id="shortcut-icon-preview" class="bi bi-star"></i></span>
                                <input type="text" class="form-control" id="shortcut-icon" value="bi-star" list="shortcut-icons">
                            </div>
                            <datalist id="shortcut-icons">
                                <option value="bi-hdd">Disk/VM</option>
                                <option value="bi-pc-display">System</option>
                                <option value="bi-cloud-arrow-up">Backup</option>
                                <option value="bi-play-circle">Start</option>
                                <option value="bi-stop-circle">Stop</option>
                                <option value="bi-info-circle">Info</option>
                                <option value="bi-graph-up">Stats</option>
                                <option value="bi-gear">Settings</option>
                                <option value="bi-shield-check">Security</option>
                                <option value="bi-diagram-3">Network</option>
                                <option value="bi-terminal">Console</option>
                                <option value="bi-star">Star</option>
                                <option value="bi-lightning">Power</option>
                            </datalist>
                            <div class="form-text">Choose an icon for this shortcut (Bootstrap Icons)</div>
                        </div>

                        <div class="mb-3">
                            <label for="shortcut-key" class="form-label">Keyboard Shortcut (Optional)</label>
                            <input type="text" class="form-control" id="shortcut-key" placeholder="e.g., Ctrl+Alt+S">
                            <div class="form-text">Optional keyboard shortcut for this command</div>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-primary" id="save-shortcut-btn">Save Shortcut</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Add Shortcuts Panel to the sidebar -->
    <div class="sidebar-panel" id="shortcuts-panel">
        <h5 class="sidebar-title d-flex align-items-center justify-content-between">
            My Shortcuts
            <button class="btn btn-sm btn-outline-secondary" id="manage-shortcuts-btn">
                <i class="bi bi-gear"></i>
            </button>
        </h5>
        
        <div id="sidebar-shortcuts-loading" class="text-center py-3">
            <div class="spinner-border spinner-border-sm text-light" role="status">
                <span class="visually-hidden">Loading...</span>
            </div>
        </div>
        
        <div id="sidebar-shortcuts-error" class="alert alert-danger d-none"></div>
        
        <div id="sidebar-shortcuts-container">
            <!-- Shortcut categories and buttons will be dynamically inserted here -->
        </div>
    </div>

    <!-- Dashboards Tab in User Profile Section -->
    <div class="tab-pane fade" id="dashboards-tab" role="tabpanel" aria-labelledby="dashboards-tab">
        <div class="d-flex justify-content-between align-items-center mb-3">
            <h5 class="mb-0">Personal Dashboards</h5>
            <button id="createDashboardBtn" class="btn btn-sm btn-primary">
                <i class="bi bi-plus"></i> New Dashboard
            </button>
        </div>
        
        <div class="alert alert-info" id="noDashboardsMessage" style="display:none;">
            You don't have any dashboards yet. Create your first dashboard to start customizing your experience.
        </div>
        
        <div id="dashboardsList" class="list-group mb-3">
            <!-- Dashboards will be loaded here -->
        </div>
        
        <div id="selectedDashboard" style="display:none;">
            <div class="d-flex justify-content-between align-items-center mb-3">
                <h5 id="dashboardTitle">Dashboard Name</h5>
                <div class="btn-group">
                    <button id="addPanelBtn" class="btn btn-sm btn-outline-primary">
                        <i class="bi bi-grid"></i> Add Panel
                    </button>
                    <button id="editDashboardBtn" class="btn btn-sm btn-outline-secondary">
                        <i class="bi bi-pencil"></i> Edit
                    </button>
                    <button id="deleteDashboardBtn" class="btn btn-sm btn-outline-danger">
                        <i class="bi bi-trash"></i>
                    </button>
                </div>
            </div>
            
            <div id="dashboardGrid" class="dashboard-grid">
                <!-- Dashboard panels will be loaded here -->
            </div>
        </div>
        
        <!-- Dashboard Edit Modal -->
        <div class="modal fade" id="dashboardModal" tabindex="-1" aria-labelledby="dashboardModalLabel" aria-hidden="true">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title" id="dashboardModalLabel">Create Dashboard</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <div class="modal-body">
                        <form id="dashboardForm">
                            <input type="hidden" id="dashboardId" value="">
                            <div class="mb-3">
                                <label for="dashboardName" class="form-label">Dashboard Name</label>
                                <input type="text" class="form-control" id="dashboardName" placeholder="My Dashboard">
                            </div>
                            <div class="mb-3">
                                <label for="dashboardLayout" class="form-label">Layout Type</label>
                                <select class="form-select" id="dashboardLayout">
                                    <option value="grid">Grid Layout</option>
                                    <option value="free">Free Layout</option>
                                </select>
                            </div>
                            <div class="form-check mb-3">
                                <input class="form-check-input" type="checkbox" id="defaultDashboard">
                                <label class="form-check-label" for="defaultDashboard">
                                    Set as default dashboard
                                </label>
                            </div>
                        </form>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                        <button type="button" class="btn btn-primary" id="saveDashboardBtn">Save</button>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Panel Edit Modal -->
        <div class="modal fade" id="panelModal" tabindex="-1" aria-labelledby="panelModalLabel" aria-hidden="true">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title" id="panelModalLabel">Add Panel</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <div class="modal-body">
                        <form id="panelForm">
                            <input type="hidden" id="panelId" value="">
                            <div class="mb-3">
                                <label for="panelTitle" class="form-label">Panel Title</label>
                                <input type="text" class="form-control" id="panelTitle" placeholder="Panel Title">
                            </div>
                            <div class="mb-3">
                                <label for="panelType" class="form-label">Panel Type</label>
                                <select class="form-select" id="panelType">
                                    <option value="vm_status">VM Status</option>
                                    <option value="system_metrics">System Metrics</option>
                                    <option value="recent_commands">Recent Commands</option>
                                    <option value="favorite_commands">Favorite Commands</option>
                                    <option value="chart">Custom Chart</option>
                                    <option value="node_status">Node Status</option>
                                    <option value="backup_status">Backup Status</option>
                                </select>
                            </div>
                            <div class="mb-3">
                                <label for="panelWidth" class="form-label">Width (1-12)</label>
                                <input type="number" class="form-control" id="panelWidth" min="1" max="12" value="6">
                            </div>
                            <div class="mb-3">
                                <label for="panelHeight" class="form-label">Height (units)</label>
                                <input type="number" class="form-control" id="panelHeight" min="1" max="12" value="4">
                            </div>
                            <div id="panelConfigContainer">
                                <!-- Dynamic panel configuration options will be loaded here -->
                            </div>
                        </form>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                        <button type="button" class="btn btn-primary" id="savePanelBtn">Save</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Command History & Favorites Tab -->
    <div class="tab-pane fade" id="command-history-tab" role="tabpanel" aria-labelledby="command-history-tab">
        <ul class="nav nav-tabs" id="commandHistoryTabs" role="tablist">
            <li class="nav-item" role="presentation">
                <button class="nav-link active" id="history-tab" data-bs-toggle="tab" data-bs-target="#history" type="button" role="tab" aria-controls="history" aria-selected="true">Command History</button>
            </li>
            <li class="nav-item" role="presentation">
                <button class="nav-link" id="favorites-tab" data-bs-toggle="tab" data-bs-target="#favorites" type="button" role="tab" aria-controls="favorites" aria-selected="false">Favorite Commands</button>
            </li>
        </ul>
        
        <div class="tab-content pt-3" id="commandHistoryTabsContent">
            <!-- Command History -->
            <div class="tab-pane fade show active" id="history" role="tabpanel" aria-labelledby="history-tab">
                <div class="d-flex justify-content-between align-items-center mb-3">
                    <div>
                        <div class="form-check form-check-inline">
                            <input class="form-check-input" type="checkbox" id="successfulCommandsOnly">
                            <label class="form-check-label" for="successfulCommandsOnly">Successful commands only</label>
                        </div>
                    </div>
                    <div>
                        <button id="clearHistoryBtn" class="btn btn-sm btn-outline-danger">
                            <i class="bi bi-trash"></i> Clear History
                        </button>
                    </div>
                </div>
                
                <div class="table-responsive">
                    <table class="table table-hover">
                        <thead>
                            <tr>
                                <th>Command</th>
                                <th>Intent</th>
                                <th>Time</th>
                                <th>Status</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="commandHistoryTable">
                            <!-- Command history will be loaded here -->
                        </tbody>
                    </table>
                </div>
                
                <div id="noHistoryMessage" class="alert alert-info mt-3" style="display:none;">
                    No command history found.
                </div>
            </div>
            
            <!-- Favorite Commands -->
            <div class="tab-pane fade" id="favorites" role="tabpanel" aria-labelledby="favorites-tab">
                <div class="mb-3">
                    <button id="addFavoriteBtn" class="btn btn-sm btn-primary">
                        <i class="bi bi-bookmark-plus"></i> Add Favorite
                    </button>
                </div>
                
                <div class="list-group" id="favoriteCommandsList">
                    <!-- Favorite commands will be loaded here -->
                </div>
                
                <div id="noFavoritesMessage" class="alert alert-info mt-3" style="display:none;">
                    No favorite commands found. Add commands to your favorites for quick access.
                </div>
            </div>
        </div>
        
        <!-- Add Favorite Modal -->
        <div class="modal fade" id="favoriteCommandModal" tabindex="-1" aria-labelledby="favoriteCommandModalLabel" aria-hidden="true">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title" id="favoriteCommandModalLabel">Add Favorite Command</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <div class="modal-body">
                        <form id="favoriteCommandForm">
                            <div class="mb-3">
                                <label for="favoriteCommandText" class="form-label">Command</label>
                                <input type="text" class="form-control" id="favoriteCommandText" placeholder="Enter command...">
                            </div>
                            <div class="mb-3">
                                <label for="favoriteCommandDescription" class="form-label">Description (optional)</label>
                                <input type="text" class="form-control" id="favoriteCommandDescription" placeholder="Command description...">
                            </div>
                        </form>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                        <button type="button" class="btn btn-primary" id="saveFavoriteBtn">Save</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Device Sync Tab -->
    <div class="tab-pane fade" id="device-sync-tab" role="tabpanel" aria-labelledby="device-sync-tab">
        <div class="d-flex justify-content-between align-items-center mb-3">
            <h5 class="mb-0">Cross-Device Profile Synchronization</h5>
            <button id="registerDeviceBtn" class="btn btn-sm btn-primary">
                <i class="bi bi-plus"></i> Register Device
            </button>
        </div>
        
        <div class="card mb-4">
            <div class="card-header">
                <h6 class="mb-0">Your Registered Devices</h6>
            </div>
            <div class="card-body">
                <div id="devicesList" class="list-group">
                    <!-- Devices will be loaded here -->
                </div>
                <div id="noDevicesMessage" class="alert alert-info mt-3" style="display:none;">
                    No devices registered. Register this device to enable profile synchronization.
                </div>
            </div>
        </div>
        
        <div class="card">
            <div class="card-header">
                <h6 class="mb-0">Synchronization Status</h6>
            </div>
            <div class="card-body">
                <div id="syncStatus">
                    <!-- Sync status will be shown here -->
                </div>
                <button id="syncNowBtn" class="btn btn-primary mt-3">
                    <i class="bi bi-arrow-repeat"></i> Sync Now
                </button>
            </div>
        </div>
        
        <!-- Register Device Modal -->
        <div class="modal fade" id="deviceModal" tabindex="-1" aria-labelledby="deviceModalLabel" aria-hidden="true">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title" id="deviceModalLabel">Register Device</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <div class="modal-body">
                        <form id="deviceForm">
                            <div class="mb-3">
                                <label for="deviceName" class="form-label">Device Name</label>
                                <input type="text" class="form-control" id="deviceName" placeholder="My Device">
                            </div>
                            <div class="mb-3">
                                <label for="deviceType" class="form-label">Device Type</label>
                                <select class="form-select" id="deviceType">
                                    <option value="desktop">Desktop</option>
                                    <option value="laptop">Laptop</option>
                                    <option value="tablet">Tablet</option>
                                    <option value="mobile">Mobile</option>
                                    <option value="other">Other</option>
                                </select>
                            </div>
                            <div class="alert alert-info">
                                <small>A unique device ID will be generated for this device.</small>
                            </div>
                        </form>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                        <button type="button" class="btn btn-primary" id="saveDeviceBtn">Register</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.socket.io/4.0.1/socket.io.min.js"></script>
    <script src="https://d3js.org/d3.v7.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="/static/js/network_diagram.js"></script>
    <script type="module" src="/static/js/app.js"></script>
    <script>
        function nextWizardStep(stepId) {
            document.getElementById(stepId).click();
        }
    </script>
</body>
</html>